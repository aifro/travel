<!DOCTYPE html><!--  Last Published: Tue Aug 13 2024 17:22:35 GMT+0000 (Coordinated Universal Time)  -->
<html data-wf-page="66bb9257dd4b7e3645975033" data-wf-site="651d42fe0d8d93b423a2aafc">
<head>
  <meta charset="utf-8">
  <title>Travel</title>
  <meta content="Travel" property="og:title">
  <meta content="Travel" property="twitter:title">
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <link href="css/normalize.css" rel="stylesheet" type="text/css">
  <link href="css/webflow.css" rel="stylesheet" type="text/css">
  <link href="css/fightflixtv2-0.webflow.css" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin="anonymous">
  <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" type="text/javascript"></script>
  <script type="text/javascript">WebFont.load({  google: {    families: ["Varela Round:400","Montserrat:100,100italic,200,200italic,300,300italic,400,400italic,500,500italic,600,600italic,700,700italic,800,800italic,900,900italic","Droid Sans:400,700"]  }});</script>
  <script type="text/javascript">!function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);</script>
  <link href="images/favicon.png" rel="shortcut icon" type="image/x-icon">
  <link href="images/webclip.png" rel="apple-touch-icon"><!--  Memberstack webflow package  -->
  <link rel="stylesheet" href="https://fengyuanchen.github.io/datepicker/css/datepicker.css">
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
</head>
<body>
  <header>
    <div class="header-content">
      <h1 class="h1-heading">Travel App</h1>
      <div id="user-auth">
        <button id="login-button" class="google-auth-button" style="display: none;">Login with Google</button>
        <div id="user-info" style="display: none;">
          <img id="user-photo" alt="User photo">
          <span id="user-name"></span>
          <button id="logout-button" class="google-auth-button">Logout</button>
        </div>
      </div>
    </div>
  </header>

  <div class="section---date">
    <div class="content-wrap">
      <div class="heading-wrap"><img loading="lazy" src="images/Logo-White.svg" alt="" class="icon-l">
        <h1 class="h1-heading">Budget Flights</h1>
        <p class="paragraph-3">Step 1: Find the best flights for your next vacation!</p>
      </div>
      <div class="flight-search-container">
        <form id="flight-form" class="flight-search-form">
          <div class="flight-search-top">
            <div class="flight-search-input departure">
              <input type="text" id="AirportCode" name="AirportCode" placeholder="From" required autocomplete="off">
            </div>
            <div class="flight-search-input destination">
              <input type="text" id="DestinationCode" name="DestinationCode" placeholder="To" required autocomplete="off">
            </div>
          </div>
          <div class="flight-search-middle">
            <div class="flight-search-input date">
              <input type="text" id="DepartDate" name="DepartDate" placeholder="Depart Date" required readonly>
            </div>
            <div class="flight-search-input date">
              <input type="text" id="ReturnDate" name="ReturnDate" placeholder="Return Date" required readonly>
            </div>
          </div>
          <div class="flight-search-bottom">
            <div class="flight-search-dropdown">
              <select id="adults" name="adults" required>
                <option value="1">1 Adult</option>
                <option value="2">2 Adults</option>
                <option value="3">3 Adults</option>
                <option value="4">4 Adults</option>
              </select>
            </div>
            <div class="flight-search-dropdown">
              <select id="travel_class" name="travel_class" required>
                <option value="ECONOMY">Economy</option>
                <option value="PREMIUM_ECONOMY">Premium Economy</option>
                <option value="BUSINESS">Business</option>
                <option value="FIRST">First Class</option>
              </select>
            </div>
            <button type="submit" class="flight-search-submit">Search Flights</button>
          </div>
        </form>

        <div id="loading-screen" style="display: none;">
          <h2>Finding the cheapest nonstop roundtrip flights for you!</h2>
        </div>

        <div id="flight-results" class="flight-results" style="display: none;">
          <h2>Best departing flights</h2>
          <div id="departure-flights"></div>
        </div>
      </div>
    </div>
  </div>
  <!-- Firebase SDK -->
  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-analytics.js";
    import { getDatabase, ref, onValue, get, query, orderByChild, equalTo } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js";
    import { getFirestore, collection, onSnapshot, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js";

    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyCH7BQJC93G_4v-ppKuWmV82E7ZYs26Lvs",
      authDomain: "travel-886d0.firebaseapp.com",
      projectId: "travel-886d0",
      storageBucket: "travel-886d0.appspot.com",
      messagingSenderId: "57887723942",
      appId: "1:57887723942:web:f0149df8e48b0bb97dff67",
      measurementId: "G-RE4WW3YV63"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const database = getDatabase(app);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Make Firebase services available globally
    window.firebaseDatabase = database;
    window.firebaseRef = ref;
    window.firebaseOnValue = onValue;
    window.firebaseGet = get;
    window.firebaseQuery = query;
    window.firebaseOrderByChild = orderByChild;
    window.firebaseEqualTo = equalTo;
    window.firebaseAuth = auth;
    window.firebaseFirestore = db;
    window.firebaseCollection = collection;
    window.firebaseOnSnapshot = onSnapshot;
    window.firebaseDoc = doc;
    window.firebaseGetDoc = getDoc;
    window.firebaseSetDoc = setDoc;

    // Google Sign-In
    const provider = new GoogleAuthProvider();

    document.getElementById('login-button').addEventListener('click', () => {
      signInWithPopup(auth, provider)
        .then((result) => {
          // Handle successful login
          console.log("User signed in:", result.user);
        }).catch((error) => {
          // Handle errors
          console.error("Error during sign in:", error);
        });
    });

    document.getElementById('logout-button').addEventListener('click', () => {
      signOut(auth).then(() => {
        console.log("User signed out");
      }).catch((error) => {
        console.error("Error during sign out:", error);
      });
    });

    onAuthStateChanged(auth, (user) => {
      if (user) {
        // User is signed in
        localStorage.setItem('userUID', user.uid);
        document.getElementById('login-button').style.display = 'none';
        document.getElementById('user-info').style.display = 'block';
        document.getElementById('user-name').textContent = user.displayName;
        document.getElementById('user-photo').src = user.photoURL;

        // Check and create user document in Firestore
        const userRef = doc(db, 'users', user.uid);
        getDoc(userRef).then((docSnapshot) => {
          if (!docSnapshot.exists()) {
            // Document doesn't exist, so create it
            setDoc(userRef, {
              email: user.email,
              createdAt: new Date(),
              // Add any other initial user data you want to store
            }).then(() => {
              console.log("User document created for:", user.uid);
            }).catch((error) => {
              console.error("Error creating user document:", error);
            });
          } else {
            console.log("User document already exists for:", user.uid);
          }
        });
      } else {
        // User is signed out
        localStorage.removeItem('userUID');
        document.getElementById('login-button').style.display = 'block';
        document.getElementById('user-info').style.display = 'none';
      }
    });
  </script>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    $(document).ready(function() {
      $('#flight-form').on('submit', function(e) {
        e.preventDefault();
        console.log('Form submitted');
        
        const userUID = localStorage.getItem('userUID');
        const searchID = Date.now().toString(); // Generate a unique search ID
        localStorage.setItem('lastSearchID', searchID); // Store the search ID
        
        console.log('User UID:', userUID);
        if (userUID) {
          var formData = {
            uid: userUID,
            Tracking_Key: searchID,
            departDate: formatDate($('#DepartDate').val()),
            returnDate: formatDate($('#ReturnDate').val()),
            departureCode: $('#AirportCode').val(),
            destinationCode: $('#DestinationCode').val(),
            adults: $('#adults').val(),
            travelClass: $('#travel_class').val()
          };
          console.log('Form data:', formData);

          // Show loading screen
          $('#loading-screen').show();
          $('#flight-results').hide();

          // Send data to Make.com
          $.ajax({
            url: 'https://hook.us1.make.com/cd46u4ziqwafgrhfxkv8jwvtjrjydfhm',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(formData),
            success: function(response) {
              console.log('Data sent to Make.com successfully');
              // Start listening for flights in Firebase
              listenForFlights(searchID);
            },
            error: function(xhr, status, error) {
              console.error('Error sending data to Make.com:', error);
              $('#loading-screen').hide();
              $('.w-form-fail').show().text('Error occurred while searching for flights. Please try again.');
            }
          });
        } else {
          console.error('User not logged in');
          $('.w-form-fail').show().text('Please log in to submit the form.');
        }
      });

      function formatDate(dateString) {
        const parts = dateString.split('-');
        if (parts.length === 3) {
          // If it's already in YYYY-MM-DD format, return as is
          return dateString;
        }
        // Assuming the current format is MM-DD-YYYY
        const date = new Date(dateString);
        return date.getFullYear() + '-' + 
               String(date.getMonth() + 1).padStart(2, '0') + '-' + 
               String(date.getDate()).padStart(2, '0');
      }

      function listenForFlights(searchID) {
        console.log('Starting to listen for flights, searchID:', searchID);
        const userUID = localStorage.getItem('userUID');
        console.log('User UID in listenForFlights:', userUID);
        if (userUID) {
          const flightsRef = firebaseCollection(firebaseFirestore, 'users', userUID, 'flights');
          console.log('Listening to:', flightsRef.path);
          
          let foundCorrectSearch = false;
          
          // Set up a timeout to stop listening after 30 seconds
          const timeoutId = setTimeout(() => {
            if (!foundCorrectSearch) {
              console.log('Search timeout reached');
              $('#loading-screen').hide();
              $('.w-form-fail').show().text('Search timed out. Please try again.');
            }
          }, 30000); // 30 seconds timeout

          firebaseOnSnapshot(flightsRef, (snapshot) => {
            console.log('Snapshot received:', snapshot.size, 'documents');
            snapshot.docChanges().forEach((change) => {
              if (change.type === "added") {
                console.log("New flight document:", change.doc.data());
                const flightData = change.doc.data();
                if (flightData.flights) {
                  try {
                    const parsedFlights = JSON.parse(flightData.flights);
                    console.log('Parsed flights:', parsedFlights);
                    console.log('Comparing Tracking_Key:', parsedFlights[0].Tracking_Key, 'with searchID:', searchID);
                    if (Array.isArray(parsedFlights) && parsedFlights.length > 0 && parsedFlights[0].Tracking_Key === searchID) {
                      foundCorrectSearch = true;
                      clearTimeout(timeoutId); // Clear the timeout as we've received data
                      displayDepartureFlights(parsedFlights);
                      $('#loading-screen').hide();
                      $('#flight-results').show();
                    } else {
                      console.log('Ignoring outdated search result. Tracking_Key:', parsedFlights[0].Tracking_Key);
                    }
                  } catch (error) {
                    console.error('Error parsing flights data:', error);
                    console.log('Raw flight data:', flightData.flights);
                    $('#loading-screen').hide();
                    $('.w-form-fail').show().text('Error processing flight data. Please try again.');
                  }
                } else {
                  console.log('No flights data in document:', change.doc.id);
                }
              }
            });
            
            if (!foundCorrectSearch) {
              console.log('Correct search result not found in this snapshot');
            }
          }, (error) => {
            console.error("Error listening for flights:", error);
            $('#loading-screen').hide();
            $('.w-form-fail').show().text('Error loading flight data. Please try again.');
          });
        } else {
          console.error('User not logged in');
          $('#loading-screen').hide();
          $('.w-form-fail').show().text('Please log in to view flight results.');
        }
      }

      function displayDepartureFlights(flights) {
        console.log('Displaying departure flights:', flights);
        var flightsList = $('#departure-flights');
        flightsList.empty();

        flights.forEach(function(flight, index) {
          console.log('Processing flight:', flight);
          var flightItem = $('<div class="flight-item">')
            .append($('<div class="flight-info">')
              .append($('<div class="flight-details">')
                .append($('<img>').attr('src', flight['1_logo']).attr('alt', `${flight['1_airline']} logo`).addClass('airline-logo'))
                .append($('<div>')
                  .append($('<div class="flight-times">').text(`${flight['1_departure_time']} - ${flight['1_arrival_time']}`))
                  .append($('<div class="flight-airports">').text(`${flight['1_departure_airport_name']} - ${flight['1_arrival_airport_name']}`))
                  .append($('<div class="flight-duration">').text(`${flight['1_duration']} min`))
                )
              )
              .append($('<div class="emissions-info">').text(`${flight['1_extensions'].split(', ').pop()}`))
            )
            .append($('<div class="flight-price">')
              .append($('<div>').text(`$${flight['Price']}`))
              .append($('<button class="select-flight">').text('Select').data('flightIndex', index))
            );

          flightsList.append(flightItem);
        });

        console.log('Finished displaying flights');

        $('.select-flight').on('click', function() {
          var flightIndex = $(this).data('flightIndex');
          console.log('Selected flight:', flights[flightIndex]);
        });
      }
    });
  </script>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      flatpickr("#DepartDate", {
        dateFormat: "m/d/Y",
        minDate: "today",
      });

      flatpickr("#ReturnDate", {
        dateFormat: "m/d/Y",
        minDate: "today",
      });
    });
  </script>
<style>
  .flight-search-container {
    width: 100%;
    max-width: none;
    padding: 20px 0;
  }

  .flight-search-form {
    display: flex;
    flex-direction: column;
    gap: 10px;
    width: 100%;
  }

  .flight-search-top,
  .flight-search-middle,
  .flight-search-bottom {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    width: 100%;
  }

  .flight-search-input,
  .flight-search-dropdown {
    flex: 1;
    min-width: 150px;
  }

  .flight-search-input input,
  .flight-search-dropdown select {
    width: 100%;
    padding: 10px;
    border: 1px solid #dadce0;
    border-radius: 4px;
    font-size: 14px;
  }

  .flight-search-input.date {
    position: relative;
  }

  .flight-search-input.date input[type="text"] {
    width: 100%;
    padding: 10px;
    border: 1px solid #dadce0;
    border-radius: 4px;
    font-size: 14px;
    cursor: pointer;
  }

  .flight-search-input.date::after {
    content: '\1F4C5'; /* Calendar emoji */
    position: absolute;
    top: 50%;
    right: 10px;
    transform: translateY(-50%);
    pointer-events: none;
  }

  .flight-search-submit {
    padding: 10px 20px;
    background-color: #642eff;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
  }

  .flight-results {
    background-color: #fff;
    border-radius: 8px;
    box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    padding: 20px;
  }

  .flight-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid #dadce0;
    padding: 20px 0;
  }

  .flight-item:last-child {
    border-bottom: none;
  }

  .flight-info {
    flex: 1;
  }

  .airline-logo {
    width: 32px;
    height: 32px;
    margin-right: 16px;
  }

  .flight-details {
    display: flex;
    align-items: center;
  }

  .flight-times {
    font-size: 18px;
    font-weight: bold;
    margin-bottom: 4px;
  }

  .flight-airports {
    color: #5f6368;
    font-size: 14px;
  }

  .flight-duration {
    color: #5f6368;
    font-size: 14px;
    margin-top: 4px;
  }

  .flight-price {
    font-size: 20px;
    font-weight: bold;
    text-align: right;
  }

  .select-flight {
    background-color: #642eff;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    margin-top: 8px;
  }

  .emissions-info {
    color: #188038;
    font-size: 12px;
    margin-top: 4px;
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    .flight-search-top,
    .flight-search-middle,
    .flight-search-bottom {
      flex-direction: column;
    }

    .flight-search-input,
    .flight-search-dropdown,
    .flight-search-submit {
      width: 100%;
    }
  }
</style>
</body>
</html>